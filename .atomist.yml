---
kind: "operation"
client: "com.atomist:rug"
version: "1.0.0-20170609011313"
editor:
  name: "PrepareTravisBuildFiles"
  group: "atomist"
  artifact: "spring-team-handlers"
  version: "0.3.1"
  parameters:
    - "project": "java-lib-seed"
    - "owner": "spring-team"
    - "encryptedGithubToken": "E**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************="
    - "encryptedArtifactoryUser": "m**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************="
    - "encryptedArtifactoryToken": "g**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************="

---
kind: "operation"
client: "com.atomist:rug"
version: "1.0.0-20170609011313"
editor:
  name: "Cascade"
  group: "atomist"
  artifact: "spring-team-handlers"
  version: "0.3.1"
  parameters:
    - "script": "{"description":"Cascaded changes from `java-lib-seed`","steps":[{"primitive":"AddFile","description":"Add file .atomist.yml","payload":{"path":".atomist.yml","content":"---\nkind: \"operation\"\nclient: \"com.atomist:rug\"\nversion: \"1.0.0-20170609011313\"\neditor:\n  name: \"PrepareTravisBuildFiles\"\n  group: \"atomist\"\n  artifact: \"spring-team-handlers\"\n  version: \"0.3.1\"\n  parameters:\n    - \"project\": \"java-lib-seed\"\n    - \"owner\": \"spring-team\"\n    - \"encryptedGithubToken\": \"E**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************=\"\n    - \"encryptedArtifactoryUser\": \"m**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************=\"\n    - \"encryptedArtifactoryToken\": \"g**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************=\"\n\n"}},{"primitive":"AddFile","description":"Add file .gitattributes","payload":{"path":".gitattributes","content":".atomist.yml linguist-generated=true\n"}},{"primitive":"AddFile","description":"Add file .travis.yml","payload":{"path":".travis.yml","content":"dist: trusty\nsudo: required\nlanguage: java\njdk:\n- oraclejdk8\nbranches:\n  except:\n  - \"/\\\\+travis\\\\d+$/\"\nenv:\n  global:\n  - secure: gg5AWJIsp+zXFkzO1C/jPC0hKqfRxuSisieDaCLwPDu3VYvV8quXcGGgSJ9JyTFrKZ64YiUtbaesFIsR3yy1Yy89iJudzqDOXoWHSRqP9wDN1/0Jnzy4mDiEFxzlDcIG6af2OhEvG5aQtxVwpLhF1LtgYNzd3cfZ1hincUPlzTxyTMpBvPP4yfUG6Dd6e1suMtQF9PSZq0YB9X9ObN4tV81ceFcVQvP7qkx1eJjhcCJPoUdp+PD+OjxkXtfWcHfHKkZoFGghizXw9kvczF8L7OznzvJ+ngQwrj7zAv5BOQpN7k9nYcEdv6tvhPUQKsW7V9uLi4HpsgzO4WIDyDvk+4WDZd93zIuO2C330H48pv+XbDj2jTfDGe00M64hKaHIQPAqERFZZyP5bPIkFEUcPbUmTAUSbnkQVHtXcM57gQaAwl46PDN2ToNpjFclOmHgSYj4OQAZEcqTdW/ez32Lb796bN+CzeQfDZc17u2mHPsadn1qpvVWbUhmtdII+yeQTeTv1mhb/WnV++HwQ8l2e5JAmE+Yw8a2pJpLaKlIIwK9AJ1+Lv9Q3oKiu2cFQldjPwidjITtM20eatDFP7CLFUa5IPwgz5myLkqUTCmJDFiVvgUA2hojL4Lv6DRPD2soI1P1FN7TUn729jjGchvfCTP648zfd9AqjzNvyorirQo=\n  - secure: mBqvTXPWWM2VowL67RWkAllURxmI64Mfjc4w/KFa3gkK2nKxKIDvKUkG7IE1yL6zMwt0yfOIWGr6ZxcRNPLRASEW0bkjLuN/BRyFJfVUfEfup6q65BLzvm9Md/Efcce7MvSzWcdTWJVT/lye1d0RXhebwBg2nlEdelaY74AEtf5Kep2KcbM8zkPX2Un6RuXKE2HSevzS12w6P1n1//ur11yFmoMV5YFUCRkR2kuZocK2Q0lDylJBp5KLlgTMraCSH9EqeI9Fu2uh45EGK1YVfiYDUwTl9lb1w0KAqjEnUqY5/EYYbrL3n4mYgJowDlZ9Nu5jTd94RA4OBHZtQaCPZNl1w+JgmHQ1clRApdV+TMjHfFeiNPkL0duM+LWiQ9yXXQ3Ap/PKdnLRGdg9yOoTdy3cww9sQx1f0aZoOvNaHhNOo10CXX+NiDm0s4309nKHKcSs9dKnXLZO1DE1KnT2AZMm8TLQLrSO2JcxVykBBxd1do+2w/nHmC10Cr4JZ1/r56DO98GRwFG/9sVmoqs8T72sGdVVXA/11+oJHq2RIYPJJk9O5O2lOTOD5iWdEVm6iuQjgzAIJwE+v9Th5dlbA6VDsJTnZn2KbpsiKA4CEi8vBszcB05s0wtDAPAOK37MQWHu5RFtCdiCulWlxxxdyNWMbmX6ucC2m9hNDsVVHtw=\n  - secure: EHtXGFQGfKL3HNQZubFu8xqFXAbym5ypYZk7HbMD0+GJ25CjnseLir3vIpXJb4TEGYnOGSOhatdKQxtVa44cLJUBGyCPM5wYM6d/t7BWOrFtyE7cdtwqKnHMwaIEZSKv1B6fajOdmLPR1OO+lZU96DwbNVNkiCzLoNrwcHnUmqEgko9RlzHHZ/qCrtd4phGyRd+wmf5jebR+WobyaDtauOH+sa8repM03LoohYEAapIgut3uJ+wUtJthNOuZByOkvyR0l1ufGWO2o74mmHQzYvmPceb7BDfV5Lwmg5KNzwgPFoVTsbKAL8nJ8CIsjZ5K/KmQmnYq7ePFrvftGpez1NbKqM9nQhhqyPS4rfGiR+NS0SE5+MvB0gJuOQU3aWgIoDUjfNPAGLiLz30tEj9z12spcOgVLcVzoTQRjD7AUK4Wjig9EcMSZ2bS+wux0G1wcRq6Uz5JZTVRhb8MA2oKvoR8D4uzfpPqWTu/iYOmGtdtVqyt7JABuKzqyB5qjMZyToEdOG9dsWjG8gt+w7c63aTZio7/qghjeIxzzTzxqSxXbk982NAC7AgbkCiIha2uamz/WHLWCa349/jJcDjMxceyQlSDzBfWwFj6pZBfcoCkyPx1TM8ueQHCLN4OnnxROaqm1/a7xG/UWXEuGSOb3u90VWrPBNFQqyxZUBcDyYM=\n  - MAVEN_BASE_URL=https://atomist.jfrog.io/atomist\ninstall: true\nscript: bash src/main/scripts/travis-build.bash\nnotifications:\n  email: false\n  webhooks:\n    urls:\n    - https://webhook.atomist.com/travis\n    on_success: always\n    on_failure: always\n    on_start: always\n    on_cancel: always\n    on_error: always\ncache:\n  directories:\n  - \"$HOME/.m2\"\n"}},{"primitive":"AddFile","description":"Add file src/main/scripts/travis-build.bash","payload":{"path":"src/main/scripts/travis-build.bash","content":"#!/bin/bash\n# build, test, and publish maven projects on Travis CI\n\nset -o pipefail\n\ndeclare Pkg=travis-build-mvn\ndeclare Version=0.4.0\n\nfunction msg() {\n    echo \"$Pkg: $*\"\n}\n\nfunction err() {\n    msg \"$*\" 1>&2\n}\n\nfunction main() {\n    msg \"branch is ${TRAVIS_BRANCH}\"\n\n    local mvn=\"mvn --settings .settings.xml -B -V -U -Datomist.enabled=false\"\n\n    local project_version\n    if [[ $TRAVIS_TAG =~ ^[0-9]+\\.[0-9]+\\.[0-9]+(-(m|rc)\\.[0-9]+)?$ ]]; then\n        if ! mvn build-helper:parse-version versions:set -DnewVersion=\"$TRAVIS_TAG\" versions:commit; then\n            err \"failed to set project version to $TRAVIS_TAG\"\n            return 1\n        fi\n        project_version=$TRAVIS_TAG\n    else\n        project_version=$(mvn help:evaluate -Dexpression=project.version | grep -E '^[0-9]+\\.[0-9]+\\.[0-9](-([0-9]{14}|SNAPSHOT))?$' | tail -n 1)\n        if [[ $? != 0 || ! $project_version ]]; then\n            err \"failed to parse project version\"\n            return 1\n        fi\n    fi\n\n    if ! $mvn install -Dmaven.javadoc.skip=true; then\n        err \"maven install failed\"\n        return 1\n    fi\n\n    if [[ $TRAVIS_PULL_REQUEST != false ]]; then\n        msg \"not deploying pull request\"\n        return 0\n    fi\n\n    if [[ $TRAVIS_BRANCH == master || $TRAVIS_TAG =~ ^[0-9]+\\.[0-9]+\\.[0-9]+(-(m|rc)\\.[0-9]+)?$ ]]; then\n        if [[ $TRAVIS_REPO_SLUG == *-seed ]]; then\n            msg \"not deploying seed project\"\n        else\n            if ! $mvn deploy -DskipTests; then\n                err \"maven deploy failed\"\n                return 1\n            fi\n        fi\n\n        if ! git config --global user.email \"travis-ci@atomist.com\"; then\n            err \"failed to set git user email\"\n            return 1\n        fi\n        if ! git config --global user.name \"Travis CI\"; then\n            err \"failed to set git user name\"\n            return 1\n        fi\n        local git_tag=$project_version+travis$TRAVIS_BUILD_NUMBER\n        if ! git tag \"$git_tag\" -m \"Generated tag from TravisCI build $TRAVIS_BUILD_NUMBER\"; then\n            err \"failed to create git tag: $git_tag\"\n            return 1\n        fi\n        local remote=origin\n        if [[ $GITHUB_TOKEN ]]; then\n            remote=https://$GITHUB_TOKEN@github.com/$TRAVIS_REPO_SLUG\n        fi\n        if ! git push --quiet --tags \"$remote\" > /dev/null 2>&1; then\n            err \"failed to push git tags\"\n            return 1\n        fi\n    fi\n}\n\nmain \"$@\" || exit 1\nexit 0\n"}}]}"

